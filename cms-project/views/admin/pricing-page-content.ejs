<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Page Content - MCA CMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    
    <!-- Include Sidebar -->
    <%- include('partials/sidebar') %>

    <!-- Main Content -->
    <div class="lg:ml-64">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center">
                    <button class="lg:hidden text-gray-600 hover:text-gray-900 mr-4" id="sidebar-toggle">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-900">Pricing Page Content</h1>
                </div>
                
                <!-- User Menu -->
                <div class="flex items-center space-x-4">
                    <a href="/admin/pricing" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Pricing
                    </a>
                    <a href="/price" target="_blank" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        <i class="fas fa-external-link-alt mr-2"></i>Preview Page
                    </a>
                    <div class="relative">
                        <button class="flex items-center text-gray-700 hover:text-gray-900" id="user-menu-button">
                            <i class="fas fa-user-circle text-2xl mr-2"></i>
                            <span>Admin</span>
                            <i class="fas fa-chevron-down ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content -->
        <main class="p-6">
            <!-- Success/Error Messages -->
            <% if (typeof success !== 'undefined' && success) { %>
                <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
                    <%= success %>
                </div>
            <% } %>
            
            <% if (typeof error !== 'undefined' && error) { %>
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
                    <%= error %>
                </div>
            <% } %>

            <div class="max-w-6xl mx-auto">
                <form action="/admin/price/update" method="POST" enctype="multipart/form-data" class="space-y-8">
                    
                    <!-- Pricing Hero Section -->
                    <div id="hero-section" class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-star text-yellow-500 mr-2"></i>
                                Pricing Hero Section
                            </h2>
                            <p class="text-sm text-gray-600 mt-1">This section appears at the top of the pricing page</p>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Hero Title -->
                                <div>
                                    <label for="hero_title" class="block text-sm font-medium text-gray-700 mb-2">
                                        Hero Title
                                    </label>
                                    <input type="text" 
                                           id="hero_title" 
                                           name="hero[title]" 
                                           value="<%= (content.hero && content.hero.title) ? content.hero.title : 'We are recognized health insurance companies' %>"
                                           placeholder="We are recognized health insurance companies"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>

                                <!-- Hero Image Upload -->
                                <div>
                                    <label for="hero_image_file" class="block text-sm font-medium text-gray-700 mb-2">
                                        Hero Image Upload
                                    </label>
                                    
                                    <!-- Current Image Display -->
                                    <% if (content.hero && content.hero.image) { %>
                                        <div class="mb-3">
                                            <div class="relative inline-block">
                                                <img src="<%= content.hero.image %>" alt="Current hero image" class="h-20 w-20 object-cover rounded-md border border-gray-300">
                                                <div class="absolute -top-2 -right-2 bg-green-500 text-white rounded-full p-1">
                                                    <i class="fas fa-check text-xs"></i>
                                                </div>
                                            </div>
                                            <p class="text-xs text-gray-500 mt-1">Current: <%= content.hero.image.split('/').pop() %></p>
                                        </div>
                                    <% } %>
                                    
                                    <!-- File Upload Input -->
                                    <div class="space-y-3">
                                        <input type="file" 
                                               id="hero_image_file" 
                                               name="hero_image_file" 
                                               accept="image/*"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                                        
                                        <!-- Selected File Name Display -->
                                        <div id="hero_file_info" class="hidden">
                                            <div class="flex items-center space-x-2 text-sm text-gray-600">
                                                <i class="fas fa-file-image text-indigo-500"></i>
                                                <span id="hero_file_name">No file selected</span>
                                                <span class="text-green-600 font-medium" id="hero_upload_status"></span>
                                            </div>
                                        </div>
                                        
                                        <!-- Image Preview -->
                                        <div id="hero_image_preview" class="hidden">
                                            <img id="hero_preview_img" class="h-32 w-32 object-cover rounded-md border border-gray-300" alt="Preview">
                                        </div>
                                    </div>
                                    
                                    <!-- Fallback URL Input -->
                                    <div class="mt-4">
                                        <label for="hero_image_url" class="block text-sm font-medium text-gray-700 mb-2">
                                            Or Enter Image URL
                                        </label>
                                        <input type="text" 
                                               id="hero_image_url" 
                                               name="hero[image]" 
                                               value="<%= (content.hero && content.hero.image) ? content.hero.image : '' %>"
                                               placeholder="media/hero-image.png"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                        <p class="text-xs text-gray-500 mt-1">File upload will override this URL</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Hero Description -->
                            <div class="mt-6">
                                <label for="hero_description" class="block text-sm font-medium text-gray-700 mb-2">
                                    Hero Description
                                </label>
                                <textarea id="hero_description" 
                                          name="hero[description]" 
                                          rows="4" 
                                          placeholder="Enter the hero section description..."
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"><%= (content.hero && content.hero.description) ? content.hero.description : 'We are QualitTop certified for personal training and fitness and are therefore recognised by twenty health insurance companies. This means that we have been audited for customer care and trainer qualifications and that we have a defined safety standard, an emergency organization, a training concept and a training plan.' %></textarea>
                            </div>

                            <!-- Hero CTA -->
                            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="hero_cta_text" class="block text-sm font-medium text-gray-700 mb-2">
                                        CTA Button Text (Optional)
                                    </label>
                                    <input type="text" 
                                           id="hero_cta_text" 
                                           name="hero[cta_text]" 
                                           value="<%= (content.hero && content.hero.cta_text) ? content.hero.cta_text : '' %>"
                                           placeholder="Learn More"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label for="hero_cta_link" class="block text-sm font-medium text-gray-700 mb-2">
                                        CTA Button Link (Optional)
                                    </label>
                                    <input type="text" 
                                           id="hero_cta_link" 
                                           name="hero[cta_link]" 
                                           value="<%= (content.hero && content.hero.cta_link) ? content.hero.cta_link : '' %>"
                                           placeholder="/contact"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Pricing Section -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-dollar-sign text-green-500 mr-2"></i>
                                Main Pricing Section
                            </h2>
                            <p class="text-sm text-gray-600 mt-1">This section contains the pricing plans and tabs</p>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Section Title -->
                                <div>
                                    <label for="pricing_title" class="block text-sm font-medium text-gray-700 mb-2">
                                        Main Section Title
                                    </label>
                                    <input type="text" 
                                           id="pricing_title" 
                                           name="pricing[title]" 
                                           value="<%= (content.pricing && content.pricing.title) ? content.pricing.title : 'Prices for Personal Training in Basel' %>"
                                           placeholder="Prices for Personal Training in Basel"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>

                                <!-- Section Subtitle -->
                                <div>
                                    <label for="pricing_subtitle" class="block text-sm font-medium text-gray-700 mb-2">
                                        Section Subtitle (Optional)
                                    </label>
                                    <input type="text" 
                                           id="pricing_subtitle" 
                                           name="pricing[subtitle]" 
                                           value="<%= (content.pricing && content.pricing.subtitle) ? content.pricing.subtitle : '' %>"
                                           placeholder="Choose the perfect plan for your fitness journey"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>
                            </div>

                            <!-- Tab Configuration -->
                            <div class="mt-6">
                                <h3 class="text-sm font-medium text-gray-700 mb-3">Pricing Category Tabs</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="tab_personal_training" class="block text-sm font-medium text-gray-700 mb-2">
                                            Personal Training Tab
                                        </label>
                                        <input type="text" 
                                               id="tab_personal_training" 
                                               name="pricing[tab_personal_training]" 
                                               value="<%= (content.pricing && content.pricing.tab_personal_training) ? content.pricing.tab_personal_training : 'Personal Training' %>"
                                               placeholder="Personal Training"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label for="tab_partner_training" class="block text-sm font-medium text-gray-700 mb-2">
                                            Partner Training Tab
                                        </label>
                                        <input type="text" 
                                               id="tab_partner_training" 
                                               name="pricing[tab_partner_training]" 
                                               value="<%= (content.pricing && content.pricing.tab_partner_training) ? content.pricing.tab_partner_training : 'Partner Personal Training' %>"
                                               placeholder="Partner Personal Training"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label for="tab_senior_training" class="block text-sm font-medium text-gray-700 mb-2">
                                            Senior Training Tab
                                        </label>
                                        <input type="text" 
                                               id="tab_senior_training" 
                                               name="pricing[tab_senior_training]" 
                                               value="<%= (content.pricing && content.pricing.tab_senior_training) ? content.pricing.tab_senior_training : 'Senior Personal Training' %>"
                                               placeholder="Senior Personal Training"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label for="tab_domizil_training" class="block text-sm font-medium text-gray-700 mb-2">
                                            Domizil Training Tab
                                        </label>
                                        <input type="text" 
                                               id="tab_domizil_training" 
                                               name="pricing[tab_domizil_training]" 
                                               value="<%= (content.pricing && content.pricing.tab_domizil_training) ? content.pricing.tab_domizil_training : 'Domizil Personal Training' %>"
                                               placeholder="Domizil Personal Training"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="tab_health_coaching" class="block text-sm font-medium text-gray-700 mb-2">
                                            Health Coaching Tab
                                        </label>
                                        <input type="text" 
                                               id="tab_health_coaching" 
                                               name="pricing[tab_health_coaching]" 
                                               value="<%= (content.pricing && content.pricing.tab_health_coaching) ? content.pricing.tab_health_coaching : 'Gesundheits-Coaching' %>"
                                               placeholder="Gesundheits-Coaching"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    </div>
                                </div>
                            </div>

                            <!-- Pricing Features -->
                            <div class="mt-6">
                                <h3 class="text-sm font-medium text-gray-700 mb-3">Pricing Section Features</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label for="pricing_features" class="block text-sm font-medium text-gray-700 mb-2">
                                            Global Features (shown below pricing)
                                        </label>
                                        <textarea id="pricing_features" 
                                                  name="pricing[features]" 
                                                  rows="3" 
                                                  placeholder="Enter features separated by new lines..."
                                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"><%= (content.pricing && content.pricing.features) ? content.pricing.features : '' %></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex justify-end">
                        <button type="submit" class="px-6 py-3 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                            <i class="fas fa-save mr-2"></i>
                            Save Page Content
                        </button>
                    </div>
                </form>

                <!-- Content Management Tips -->
                <div class="mt-8 bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                            Content Management Tips
                        </h2>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="font-medium text-gray-900 mb-2">Hero Section</h3>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Keep titles engaging and benefit-focused</li>
                                    <li>• Use high-quality images that reflect your service</li>
                                    <li>• Hero description should build trust and credibility</li>
                                    <li>• CTA button should guide users to next action</li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="font-medium text-gray-900 mb-2">Pricing Section</h3>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Tab names should be clear and descriptive</li>
                                    <li>• Individual plans are managed in the Pricing Manager</li>
                                    <li>• Use features to highlight what's included</li>
                                    <li>• Test pricing display on different devices</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded">
                            <div class="flex">
                                <i class="fas fa-info-circle text-blue-600 mt-0.5 mr-2"></i>
                                <div class="text-sm text-blue-800">
                                    <strong>Note:</strong> Individual pricing plans are managed through the 
                                    <a href="/admin/pricing" class="underline hover:text-blue-900">Pricing Manager</a>. 
                                    This page only controls the section headers, descriptions, and overall page content.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Image Upload JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const heroFileInput = document.getElementById('hero_image_file');
            const heroFileInfo = document.getElementById('hero_file_info');
            const heroFileName = document.getElementById('hero_file_name');
            const heroUploadStatus = document.getElementById('hero_upload_status');
            const heroImagePreview = document.getElementById('hero_image_preview');
            const heroPreviewImg = document.getElementById('hero_preview_img');
            const heroImageUrl = document.getElementById('hero_image_url');
            
            if (heroFileInput) {
                heroFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    
                    if (file) {
                        // Generate the filename that will be used on the backend
                        const timestamp = Date.now();
                        const randomNum = Math.round(Math.random() * 1E9);
                        const ext = file.name.split('.').pop();
                        const nameWithoutExt = file.name.replace('.' + ext, '');
                        const generatedName = `${nameWithoutExt}-${timestamp}-${randomNum}.${ext}`;
                        
                        // Show file info
                        heroFileInfo.classList.remove('hidden');
                        heroFileName.textContent = generatedName;
                        heroUploadStatus.textContent = 'Ready to upload';
                        
                        // Update the URL field with the generated filename
                        heroImageUrl.value = `/media/${generatedName}`;
                        
                        // Show image preview
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                heroPreviewImg.src = e.target.result;
                                heroImagePreview.classList.remove('hidden');
                            };
                            reader.readAsDataURL(file);
                        }
                        
                        // Add upload success indicator
                        heroUploadStatus.innerHTML = '<i class="fas fa-check-circle"></i> Ready to upload';
                        heroUploadStatus.className = 'text-green-600 font-medium flex items-center space-x-1';
                    } else {
                        // Hide file info if no file selected
                        heroFileInfo.classList.add('hidden');
                        heroImagePreview.classList.add('hidden');
                        heroUploadStatus.textContent = '';
                    }
                });
            }
            
            // Form submission handler
            const form = document.querySelector('form[action="/admin/price/update"]');
            if (form) {
                form.addEventListener('submit', function(e) {
                    const fileInput = document.getElementById('hero_image_file');
                    if (fileInput && fileInput.files.length > 0) {
                        // Show uploading status
                        heroUploadStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
                        heroUploadStatus.className = 'text-blue-600 font-medium flex items-center space-x-1';
                        
                        // Disable submit button to prevent double submission
                        const submitBtn = form.querySelector('button[type="submit"]');
                        if (submitBtn) {
                            submitBtn.disabled = true;
                            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Uploading & Saving...';
                        }
                    }
                });
            }
        });
    </script>

    <!-- Include Sidebar JavaScript -->
    <%- include('partials/sidebar-script') %>
</body>
</html>
